/* eslint-disable @typescript-eslint/no-explicit-any */
import React, { useEffect } from 'react'
import { useMutation, useQuery, useQueryClient } from 'react-query'
import { Link } from 'react-router-dom'
import { buyProducts, getPurchasesOnline } from 'src/apis/purchase.api'
import Button from 'src/components/Button'
import useQueryParams from 'src/hooks/useQueryParams'

const PaymentSuccess = () => {
  const queryParams = useQueryParams()
  const queryClient = useQueryClient()

  const { data: purchaseOnlineData } = useQuery({
    queryKey: ['purchaseOnline'],
    queryFn: () => getPurchasesOnline(queryParams.orderInfo)
  })
  const dataPurchases = purchaseOnlineData?.data.data
  const buyPurchaseMutation = useMutation({
    mutationFn: (body: any) => {
      return buyProducts(queryParams.orderInfo, body)
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['purchases', queryParams.orderInfo] })
    }
  })

  useEffect(() => {
    const id = setTimeout(() => {
      const bodyData = dataPurchases.map((item: any) => {
        return {
          product_id: item.product._id,
          buy_count: item.buy_count
        }
      })
      buyPurchaseMutation.mutate({ body: bodyData, paymentMethods: 1 })
    }, 1000)
    return () => {
      clearTimeout(id)
    }
  }, [purchaseOnlineData])

  return (
    <div className='h-screen flex justify-center items-center '>
      <div className='shadow-md justify-center items-center dark:bg-[#1C1C24] rounded-md mx-auto w-[466px] py-[60px] px-[50px] flex flex-col gap-y-[15px]'>
        <div className='flex justify-center'>
          <svg width={46} height={46} viewBox='0 0 46 46' fill='none' xmlns='http://www.w3.org/2000/svg'>
            <g clipPath='url(#clip0_2846_6154)'>
              <path
                d='M41.2761 31.1101C40.3881 29.8195 40.8838 27.9539 40.6628 25.8942C40.4353 22.5336 38.9914 19.2778 36.1906 16.6737L26.6507 7.80339C26.6507 7.80339 24.7711 6.05411 23.0205 7.935C21.2725 9.81461 23.1534 11.5639 23.1534 11.5639L27.1835 15.3129L30.6769 18.561C30.6769 18.561 29.8017 19.5014 25.9351 15.9058L12.8762 3.75923C12.8762 3.75923 10.9941 2.01123 9.24477 3.89211C7.49677 5.77173 9.37639 7.521 9.37639 7.521L21.7248 19.0069C21.698 18.9814 20.7908 19.8912 20.7742 19.8758L7.56194 7.58745C7.56194 7.58745 5.68105 5.83817 3.93177 7.71906C2.1825 9.59995 4.06339 11.3479 4.06339 11.3479L17.2769 23.6389C17.2922 23.6542 16.4412 24.6151 16.4668 24.6394L5.069 14.0364C5.069 14.0364 3.18811 12.2871 1.43883 14.168C-0.310447 16.0489 1.57044 17.7982 1.57044 17.7982L13.6889 29.0682C13.8001 29.1717 13.05 30.2284 13.1893 30.3574L4.45694 22.2359C4.45694 22.2359 2.57605 20.4866 0.826775 22.3688C-0.922503 24.2497 0.958386 25.9989 0.958386 25.9989L15.2018 39.2406C17.5797 41.4524 20.0216 42.5717 22.9656 42.9819C23.5648 43.0649 24.3315 43.0649 24.6458 43.1046C25.6387 43.2298 26.5101 43.5824 27.6767 44.298C29.1781 45.218 31.4308 45.6013 32.7252 44.2175L37.1387 39.4961L41.2135 35.1363C42.5066 33.7538 42.2753 32.5603 41.2761 31.1101Z'
                fill='#EF9645'
              />
              <path
                d='M2.49809 44.7554C2.17098 44.7554 1.84387 44.6302 1.5947 44.381C1.09509 43.8814 1.09509 43.0738 1.5947 42.5742L6.13209 38.0394C6.6317 37.5398 7.43925 37.5398 7.93887 38.0394C8.43848 38.539 8.43848 39.3465 7.93887 39.8462L3.40148 44.3823C3.15231 44.6314 2.8252 44.7554 2.49809 44.7554ZM11.118 45.9335C10.9787 45.9335 10.8356 45.9105 10.695 45.8619C10.0293 45.6294 9.67792 44.9011 9.91175 44.2341L11.1525 40.6908C11.385 40.0251 12.1146 39.6749 12.7804 39.9062C13.4461 40.1401 13.7975 40.8684 13.5636 41.5341L12.3229 45.0774C12.1389 45.6038 11.6457 45.9335 11.118 45.9335ZM1.32125 36.1368C0.79481 36.1368 0.301588 35.8084 0.11631 35.2845C-0.118801 34.6188 0.230032 33.8892 0.895754 33.654L4.08381 32.5283C4.75209 32.2983 5.47914 32.6446 5.71425 33.3078C5.94937 33.9735 5.60053 34.7031 4.93481 34.9382L1.74675 36.0639C1.60492 36.1138 1.46181 36.1368 1.32125 36.1368ZM38.9646 8.32338C38.6375 8.32338 38.3104 8.19816 38.0612 7.949C37.5616 7.44938 37.5616 6.64055 38.0612 6.14094L42.5999 1.60483C43.0995 1.1065 43.907 1.1065 44.4066 1.60483C44.9063 2.10316 44.9063 2.91327 44.4066 3.41288L39.868 7.949C39.6188 8.19944 39.2917 8.32338 38.9646 8.32338ZM33.6439 6.15499C33.5046 6.15499 33.3615 6.13072 33.2223 6.08216C32.5565 5.84961 32.2051 5.12127 32.4377 4.45427L33.6771 0.910995C33.911 0.245273 34.638 -0.106116 35.305 0.126439C35.9708 0.358995 36.3221 1.08733 36.0896 1.75433L34.8501 5.29761C34.6661 5.82533 34.1716 6.15499 33.6439 6.15499ZM41.4933 13.5329C40.9669 13.5329 40.4736 13.2045 40.2884 12.6806C40.0533 12.0149 40.4034 11.2853 41.0678 11.0502L44.2546 9.92444C44.9216 9.68805 45.6499 10.0394 45.885 10.7039C46.1201 11.3696 45.77 12.0992 45.1056 12.3343L41.9188 13.4601C41.777 13.5099 41.6339 13.5329 41.4933 13.5329Z'
                fill='#A992FE'
              />
              <path
                d='M45.2218 30.4392C44.3772 29.1205 44.9356 27.2716 44.7849 25.2054C44.6699 21.8397 43.3371 18.5367 40.6257 15.8393L31.3899 6.65333C31.3899 6.65333 29.5704 4.84272 27.7572 6.66355C25.9466 8.48311 27.7674 10.295 27.7674 10.295L31.6697 14.1782L35.0507 17.5413C35.0507 17.5413 34.1435 18.4511 30.4009 14.7276C26.6557 11.0029 17.7586 2.14789 17.7586 2.14789C17.7586 2.14789 15.9377 0.337276 14.1259 2.15811C12.314 3.97766 14.1348 5.78828 14.1348 5.78828L26.0897 17.6844C26.0641 17.6588 25.1262 18.5367 25.1096 18.5201L12.3191 5.79339C12.3191 5.79339 10.4982 3.9815 8.68635 5.80233C6.87574 7.62316 8.69529 9.43378 8.69529 9.43378L21.4871 22.163C21.5025 22.1783 20.6182 23.1098 20.6438 23.1354L9.61018 12.1554C9.61018 12.1554 7.78935 10.3448 5.97746 12.1657C4.16557 13.9865 5.98641 15.7984 5.98641 15.7984L17.7177 27.4709C17.825 27.5769 17.0405 28.6094 17.1746 28.7436L8.72085 20.3319C8.72085 20.3319 6.90002 18.5213 5.08813 20.3422C3.27624 22.163 5.09707 23.9749 5.09707 23.9749L18.8843 37.688C21.1868 39.9791 23.5891 41.1789 26.5177 41.6887C27.1145 41.7922 27.8811 41.8178 28.1929 41.8676C29.1806 42.0261 30.0393 42.4081 31.1829 43.1633C32.6524 44.1331 34.891 44.5918 36.2314 43.2527L40.802 38.6834L45.0212 34.4642C46.3616 33.1225 46.1712 31.9214 45.2218 30.4392Z'
                fill='#FFDD62'
              />
            </g>
            <defs>
              <clipPath id='clip0_2846_6154'>
                <rect width={46} height={46} fill='white' />
              </clipPath>
            </defs>
          </svg>
        </div>
        <h1 className='font-[700] text-[25px] leading-[38px] dark:text-white'>Thanh Toán thành công!</h1>
        <div className='text-text-color'>Cảm ơn đã sử dụng dịch vụ của chúng tôi!</div>
        {/* <button onClick={handleOK}>OK</button> */}
        <Link to='/cart'>
          <Button>Trở lại giỏ hàng</Button>
        </Link>
      </div>
    </div>
  )
}

export default PaymentSuccess
